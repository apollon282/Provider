---
subcategory: ""
page_title: "Kustomize Flux"
description: |-
  Kustomizing Flux past the exposed parameters.
---

# Kustomize Flux

The Flux datasources expose a set of parameters that can configure the controller deployment. These parameters are identical to the ones
exposed by the `flux bootstrap` CLI command. There may be situations where the exposed parameters are not enough and additional configuration
has to be done. This could be changing the resource requests or limits for a controller, adding annotations or labels, or modifying container settings.
When deploying Flux with the CLI the reccomended solution is to [modify the kustomization file](https://fluxcd.io/docs/installation/#customize-flux-manifests).
This is also the reccomended way when deploying with Terraform, but it requires some extra considerations as changes made manually to
the repository after deployment would be overridden the next time the Terraform is applied.

Given that the Github example has been followed the solution is simple as all that is required is to override the kustomization content output from the datasource.
The following kustomization file can be used instead. Note the strategic merge which adds a priority class to the source controller. It is important that the
resources list contains the `gotk-components.yaml` and `gotk-sync.yaml` files as otherwise the Flux manifests will not be included in the Kustomization.
```terraform
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
resources:
  - gotk-components.yaml
  - gotk-sync.yaml
patchesStrategicMerge:
- |-
  apiVersion: apps/v1
  kind: Deployment
  metadata:
    name: source-controller
    namespace: flux-system
  spec:
    template:
      spec:
        priorityClassName: system-node-critical
```

Using the custom Kustomization file is as simple as ignoring the datasource input and instead comitting the local Kustomization file instead.
```terraform
terraform {
  required_version = ">= 0.13"

  required_providers {
    github = {
      source = "integrations/github"
      version = "4.5.2"
    }
  }
}

resource "github_repository_file" "kustomize" {
  repository = github_repository.main.name
  file       = data.flux_sync.main.kustomize_path
  content    = file("${path.module}/kustomization-override.yaml")
  branch     = var.branch
}
```
